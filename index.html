<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Date Calculator</title>

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">

<style>
body {
  font-family: Arial, sans-serif;
  padding: 20px;
  background-color: #f9f9f9;
}

h2 {
  text-align: center;
  margin-bottom: 20px;
}

.calculator-box {
  background-color: #fff;
  padding: 20px;
  border-radius: 12px;
  box-shadow: 0 4px 12px rgba(0,0,0,0.1);
  max-width: 400px;
  margin: auto;
}

#modeContainer { padding-top: 12px; margin-bottom: 12px; }

label {
  font-size: 0.7rem;
  display: block;
}

input, select, button {
  font-size: 0.9rem;
  padding: 4px 6px;
  margin-top: 8px;
  width: 100%;
  box-sizing: border-box;
}

#addMode #startDate { margin-bottom: 8px; }

.checkbox-inline {
  display: flex;
  align-items: center;
  gap: 6px;
  font-size: 0.8rem;
  color: #666;
  margin-top: 10px;
}
.checkbox-inline input[type="checkbox"] { width: auto; height: auto; margin: 0; }

.output-container {
  display: none;
  margin-top: 12px;
  justify-content: flex-start;
  align-items: center;
  gap: 8px;
}
#output {
  flex: 1 1 auto;
  font-size: 0.9rem;
  padding: 4px 6px;
}
#copiedText {
  font-size: 0.8rem;
  color: green;
  display: none;
  white-space: nowrap;
}
button.copy-btn {
  flex: 0 0 auto;
  font-size: 0.8rem;
  padding: 4px 10px;
  border-radius: 6px;
  border: 1px solid #ccc;
  background-color: #fff;
  cursor: pointer;
  width: auto;
}

#summary {
  font-size: 0.8rem;
  color: #555;
  margin: 12px 0;
  text-align: left;
}

button.calculate { width: 100%; font-size: 0.85rem; margin-top: 12px; }

@media (max-width: 480px) {
  input, select, button {
    font-size: 1rem;
    padding: 8px 10px;
  }

  label { margin-top: 14px; }

  /* Output container adjustments stay the same */
  .output-container { flex-wrap: wrap; }
  #output { flex: 1 1 100%; margin-right: 0; margin-bottom: 5px; }
  #copiedText { order: 1; margin: 0 5px 5px 0; }
  button.copy-btn { order: 2; flex: 0 0 auto; }
  button.calculate { padding: 10px 15px; font-size: 1rem; }

  /* Mobile-only date field width fix (reinstate prior fix) */
  #startDate,
  #date1,
  #date2,
  #mode {
    width: calc(100% - 12px);
    margin-left: 6px;
    margin-right: 6px;
    box-sizing: border-box;
  }

  /* Shift Include start/end day checkboxes slightly right */
  #includeStart,
  #includeEnd {
    margin-left: 6px; /* adjust as desired */
  }
  /* Make mobile date fields same width as other inputs */
  #startDate,
  #date1,
  #date2 {
    width: 100%;
    max-width: 100%;
    box-sizing: border-box;
    padding: 8px 10px;
    margin-left: 0;
    margin-right: 0;
  }



@media (min-width: 481px) { #date1 { margin-bottom: 12px; } }

.flatpickr-input {
  width: 100% !important;
  box-sizing: border-box;
  padding: 4px 6px !important;
  font-size: 0.9rem !important;
}
</style>
</head>
<body>

<h2>Date Calculator</h2>

<div class="calculator-box">

  <div id="modeContainer">
    <label for="mode">Select Calculation Mode:</label>
    <select id="mode" onchange="toggleMode()">
      <option value="add" selected>Add Days/Weeks/Months to Date</option>
      <option value="between">Duration Between Dates</option>
    </select>
  </div>

  <div id="addMode">
    <label for="startDate">Start Date:</label>
    <input type="text" id="startDate" placeholder="Select a date">

    <label for="duration">Duration:</label>
    <input type="number" id="duration" placeholder="Enter number" min="1">

    <select id="unit">
      <option value="days" selected>Days</option>
      <option value="weeks">Weeks</option>
      <option value="months">Months</option>
    </select>

    <label class="checkbox-inline"><input type="checkbox" id="includeStart"> Include start day</label>

    <select id="monthType">
      <option value="28">28-day month</option>
      <option value="calendar">Calendar month</option>
    </select>

    <select id="format">
      <option value="dayMon" selected>Day Mon</option>
      <option value="ddmmyyyy">DD/MM/YYYY</option>
      <option value="iso">ISO YYYY-MM-DD</option>
    </select>
  </div>

  <div id="betweenMode" style="display: none;">
    <label for="date1">Start Date:</label>
    <input type="text" id="date1" placeholder="Select first date">

    <label for="date2">End Date:</label>
    <input type="text" id="date2" placeholder="Select second date">

    <label class="checkbox-inline"><input type="checkbox" id="includeEnd"> Include end date</label>
  </div>

  <div class="output-container" id="outputContainer">
    <input type="text" id="output" readonly>
    <span id="copiedText">Copied</span>
    <button class="copy-btn" onclick="copyOutput()">Copy</button>
  </div>

  <div id="summary"></div>

  <button class="calculate" onclick="calculate()">Calculate</button>
</div>

<script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
<script>
if (window.innerWidth > 480) {  // desktop only
  flatpickr("#startDate", { dateFormat: "Y-m-d", disableMobile: false });
  flatpickr("#date1", { dateFormat: "Y-m-d", disableMobile: false });
  flatpickr("#date2", { dateFormat: "Y-m-d", disableMobile: false });
}


function toggleMode() {
  const mode = document.getElementById('mode').value;
  document.getElementById('addMode').style.display = mode === 'add' ? 'block' : 'none';
  document.getElementById('betweenMode').style.display = mode === 'between' ? 'block' : 'none';
  document.getElementById('outputContainer').style.display = 'none';
  document.getElementById('summary').textContent = '';
}

function formatDate(date, format) {
  const day = ("0" + date.getDate()).slice(-2);
  const month = ("0" + (date.getMonth() + 1)).slice(-2);
  const year = date.getFullYear();
  const monthNames = ["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];
  if (format === 'dayMon') return day + ' ' + monthNames[date.getMonth()];
  if (format === 'ddmmyyyy') return `${day}/${month}/${year}`;
  if (format === 'iso') return `${year}-${month}-${day}`;
  return '';
}

function calculate() {
  const mode = document.getElementById('mode').value;
  let result = "";
  let summary = "";

  if (mode === 'add') {
    const start = new Date(document.getElementById('startDate').value);
    const duration = parseInt(document.getElementById('duration').value);
    const includeStart = document.getElementById('includeStart').checked;
    const unit = document.getElementById('unit').value;
    const monthType = document.getElementById('monthType').value;
    const format = document.getElementById('format').value;

    if (isNaN(start) || isNaN(duration) || duration < 1) {
      alert('Please select a valid start date and duration.');
      return;
    }

    let end = new Date(start);
    if (unit === 'days') end.setDate(end.getDate() + duration - (includeStart ? 1 : 0));
    else if (unit === 'weeks') end.setDate(end.getDate() + duration * 7 - (includeStart ? 1 : 0));
    else if (unit === 'months') {
      if (monthType === '28') end.setDate(end.getDate() + duration * 28 - (includeStart ? 1 : 0));
      else {
        end.setMonth(end.getMonth() + duration);
        if (!includeStart) end.setDate(end.getDate() - 1);
      }
    }

    result = formatDate(end, format);
    summary = `Start: ${formatDate(start, format)} | Duration: ${duration} ${unit} | End: ${result}`;
  } else if (mode === 'between') {
    const d1 = new Date(document.getElementById('date1').value);
    const d2 = new Date(document.getElementById('date2').value);
    const includeEnd = document.getElementById('includeEnd').checked;

    if (isNaN(d1) || isNaN(d2)) {
      alert('Please select both dates.');
      return;
    }

    let diffTime = Math.abs(d2 - d1);
    let diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
    if (includeEnd) diffDays += 1;

    if (diffDays <= 6) result = `${diffDays} ${diffDays === 1 ? "day" : "days"}`;
    else if (diffDays === 7) result = "7 days (1 week)";
    else {
      const weeks = Math.floor(diffDays / 7);
      const daysRemainder = diffDays % 7;
      let breakdown = `${weeks} ${weeks === 1 ? "week" : "weeks"}`;
      if (daysRemainder > 0) breakdown += ` + ${daysRemainder} ${daysRemainder === 1 ? "day" : "days"}`;
      result = `${diffDays} days (${breakdown})`;
    }

    summary = `${d1.toDateString()} to ${d2.toDateString()} = ${result}`;
  }

  document.getElementById('output').value = result;
  document.getElementById('outputContainer').style.display = 'flex';
  document.getElementById('summary').textContent = summary;
}

function copyOutput() {
  const output = document.getElementById('output');
  output.select();
  document.execCommand("copy");
  const copiedText = document.getElementById('copiedText');
  copiedText.style.display = 'inline';
  setTimeout(() => copiedText.style.display = 'none', 1500);
}
</script>

</body>
</html>
