<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Date Calculator</title>

<!-- Flatpickr CSS -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">

<style>
  body { font-family: Arial, sans-serif; padding: 20px; background-color: #f9f9f9; }
  h2 { text-align: center; margin-bottom: 20px; }
  .calculator-box {
	background-color: #fff;
	padding: 20px;
	border-radius: 12px;
	box-shadow: 0 4px 12px rgba(0,0,0,0.1);
	max-width: 400px;
	margin: auto;
  }
  label { display: block; margin-top: 12px; font-size: 0.7rem; }
  input, select { padding: 4px 6px; margin-top: 8px; width: 100%; box-sizing: border-box; font-size: 0.9rem; }
  .checkbox-container { padding: 1px 0; margin-top: 8px; margin-bottom: 8px; }
  input[type="checkbox"] { width: auto; vertical-align: middle; margin-top: 0; }
  .output-container { display: none; margin-top: 12px; justify-content: flex-end; align-items: center; }
  #output { flex: 1; font-size: 0.9rem; margin-right: 10px; }
  #copiedText { font-size: 0.8rem; color: green; display: none; margin-right: 10px; white-space: nowrap; }
  #summary { font-size: 0.8rem; color: #555; margin: 5px 0 10px 0; }
  button { padding: 4px 10px; font-size: 0.9rem; }
  button.calculate { width: 100%; margin-top: 15px; font-size: 0.85rem; }
  button.copy-btn { border-radius: 8px; background-color: white; border: 1px solid #ccc; }

  /* Compact Flatpickr calendar */
  .flatpickr-calendar { font-size: 0.78rem; max-width: 95%; }
  .flatpickr-weekday { font-size: 0.68rem; padding: 2px 0; }
  .flatpickr-day { font-size: 0.78rem; padding: 7px 6px; margin: 1px; border-radius: 5px; }
  .flatpickr-month { font-size: 0.78rem; }
  .flatpickr-week { margin-bottom: 2px; }

  /* MOBILE FRIENDLY STYLING */
  @media (max-width: 480px) {
	input, select, button {
	  padding: 8px 10px;
	  font-size: 1rem;
	}
	label { margin-top: 14px; }

	.output-container {
	  flex-wrap: wrap;
	}
	#output {
	  flex: 1 1 100%;
	  margin-right: 0;
	  margin-bottom: 5px;
	}
	#copiedText {
	  order: 1;
	  margin: 0 5px 5px 0;
	}
	button.copy-btn {
	  order: 2;
	  flex: 0 0 auto;
	}
	button.calculate {
	  padding: 10px 15px;
	  font-size: 1rem;
	}

	/* Start Date field width fixed to match other inputs */
	#startDate { 
		width: 100%;
		box-sizing: border-box; /* ensures padding is included inside width */
		margin-right: 0;         /* aligns with other fields */
	}
  }
</style>
</head>
<body>

<h2>Date Calculator</h2>

<div class="calculator-box">

  <label for="startDate">Start Date:</label>
  <input type="text" id="startDate" placeholder="Select a date">

  <label for="duration">Duration:</label>
  <input type="number" id="duration" placeholder="Enter number" min="1">

  <select id="unit">
	<option value="days" selected>Days</option>
	<option value="weeks">Weeks</option>
	<option value="months">Months</option>
  </select>

  <div class="checkbox-container">
	<label><input type="checkbox" id="includeStart"> Include start day</label>
  </div>

  <select id="monthType">
	<option value="28">28-day month</option>
	<option value="calendar">Calendar month</option>
  </select>

  <select id="format">
	<option value="dayMon" selected>Day Mon</option>
	<option value="ddmmyyyy">DD/MM/YYYY</option>
	<option value="iso">ISO YYYY-MM-DD</option>
  </select>

  <div class="output-container" id="outputContainer">
	<input type="text" id="output" readonly>
	<span id="copiedText">Copied</span>
	<button class="copy-btn" onclick="copyOutput()">Copy</button>
  </div>

  <div id="summary"></div>

  <button class="calculate" onclick="calculate()">Calculate End Date</button>

</div>

<!-- Flatpickr JS -->
<script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
<script>
flatpickr("#startDate", {
	dateFormat: "Y-m-d",
	allowInput: true,
	clickOpens: true,
	onChange: function(selectedDates, dateStr, instance) {
		instance.close(); // auto-close calendar on selection
	},
	disableMobile: false, // allow iOS to use native picker
	position: "auto"
});

function formatDate(date, format) {
	const day = ("0" + date.getDate()).slice(-2);
	const month = ("0" + (date.getMonth() + 1)).slice(-2);
	const year = date.getFullYear();
	const monthNames = ["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];
	if (format === 'dayMon') return day + ' ' + monthNames[date.getMonth()];
	if (format === 'ddmmyyyy') return `${day}/${month}/${year}`;
	if (format === 'iso') return `${year}-${month}-${day}`;
	return '';
}

function calculate() {
	const start = new Date(document.getElementById('startDate').value);
	const duration = parseInt(document.getElementById('duration').value);
	const includeStart = document.getElementById('includeStart').checked;
	const unit = document.getElementById('unit').value;
	const monthType = document.getElementById('monthType').value;
	const format = document.getElementById('format').value;

	if (isNaN(start) || isNaN(duration) || duration < 1) {
		alert('Please select a valid start date and duration.');
		return;
	}

	let end = new Date(start);

	if (unit === 'days') {
		end.setDate(end.getDate() + duration - (includeStart ? 1 : 0));
	} else if (unit === 'weeks') {
		end.setDate(end.getDate() + duration * 7 - (includeStart ? 1 : 0));
	} else if (unit === 'months') {
		if (monthType === '28') {
			end.setDate(end.getDate() + duration * 28 - (includeStart ? 1 : 0));
		} else {
			end.setMonth(end.getMonth() + duration);
			if (!includeStart) end.setDate(end.getDate() - 1);
		}
	}

	const outputContainer = document.getElementById('outputContainer');
	outputContainer.style.display = 'flex';

	const outputField = document.getElementById('output');
	outputField.value = formatDate(end, format);

	outputField.focus();
	outputField.select();

	document.getElementById('copiedText').style.display = 'none';

	document.getElementById('summary').textContent =
		`Start: ${formatDate(start, format)} | Duration: ${duration} ${unit} | End: ${formatDate(end, format)}`;
}

function copyOutput() {
	const output = document.getElementById('output');
	output.select();
	output.setSelectionRange(0, 99999);
	document.execCommand("copy");

	const copiedText = document.getElementById('copiedText');
	copiedText.style.display = 'inline';
	setTimeout(() => {
		copiedText.style.display = 'none';
	}, 1500);
}
</script>

</body>
</html>
